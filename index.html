<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nelson SESAMI</title>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
/* â”€â”€ RESET: neutraliza CSS externo (GitHub Pages / primer) â”€â”€ */
*, *::before, *::after {
  box-sizing: border-box !important;
}
html, body {
  all: unset;
  display: block;
}
body {
  background: var(--bg) !important;
  color: var(--ink) !important;
  font-family: 'Calibri', sans-serif !important;
  font-size: 14px !important;
  margin: 0 !important;
  padding: 0 !important;
  min-height: 100vh !important;
}
a { color: inherit !important; text-decoration: none !important; }
button { font-family: inherit !important; }
input, select, textarea { font-family: inherit !important; }
.page { display: none !important; }
.page.active { display: flex !important; flex-direction: column !important; flex: 1 !important; }


:root{
  /* â”€â”€ Dark theme unified â”€â”€ */
  --bg:#0d1117;--surface:#161b22;--surface2:#1c2333;--border:rgba(255,255,255,0.09);
  --ink:#e6edf3;--ink2:#b0bec8;--muted:#7d8590;
  /* â”€â”€ Brand SESAMI â”€â”€ */
  --sesami:#5CE5DB;--sesami2:rgba(92,229,219,0.15);--sesami3:rgba(92,229,219,0.08);
  /* â”€â”€ Accents â”€â”€ */
  --accent:#5CE5DB;--accent2:#3fb950;--accent3:#58a6ff;--gold:#d29922;
  /* â”€â”€ Radar (same palette) â”€â”€ */
  --r-bg:#0d1117;--r-surface:#161b22;--r-surface2:#1c2333;
  --r-border:rgba(255,255,255,0.09);--r-accent:#5CE5DB;
  --r-text:#e6edf3;--r-muted:#7d8590;
  --hot:#ff4757;--warm:#ffa502;--cold:#4d9fff;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--ink);font-family:'Calibri','Calibri Light',Calibri,sans-serif;min-height:100vh}
.shell{display:grid;grid-template-columns:220px 1fr;min-height:100vh}
.nav{background:#0d1117;border-right:1px solid rgba(255,255,255,0.07);display:flex;flex-direction:column;height:100vh;position:sticky;top:0;overflow-y:auto}
.nav-brand{padding:24px 20px 20px;border-bottom:1px solid rgba(92,229,219,0.12)}
.nav-brand-name{font-family:'Instrument Serif',serif;font-size:22px;color:var(--ink);line-height:1.2}
.nav-brand-sub{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:1.5px;margin-top:4px}
.nav-items{padding:16px 12px;flex:1}
.nav-section{font-size:9px;font-family:'DM Mono',monospace;color:rgba(92,229,219,0.35);text-transform:uppercase;letter-spacing:1.5px;padding:0 12px;margin:16px 0 6px}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:8px;cursor:pointer;transition:all .15s;color:var(--muted);font-size:13px;font-family:'Calibri',sans-serif;margin-bottom:2px;border:1px solid transparent;user-select:none}
.nav-item:hover{background:rgba(92,229,219,0.06);color:var(--ink)}
.nav-item.active{background:rgba(92,229,219,0.1);color:var(--sesami);border-color:rgba(92,229,219,0.2)}
.ni-icon{width:28px;height:28px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;background:rgba(255,255,255,0.05)}
.nav-item.active .ni-icon{background:rgba(92,229,219,0.15)}
.nav-footer{padding:16px 24px;border-top:1px solid rgba(255,255,255,0.07)}
.nav-user{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace}
.nav-user strong{color:var(--ink2);display:block;font-size:12px;margin-bottom:2px}
.main-area{display:flex;flex-direction:column;overflow:hidden;min-height:100vh}
.topbar{background:#0d1117;border-bottom:1px solid rgba(92,229,219,0.1);padding:0 36px;height:60px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:10;flex-shrink:0}
.topbar-title{font-family:'Instrument Serif',serif;font-size:20px;color:var(--ink)}
.tag{font-size:10px;font-family:'DM Mono',monospace;padding:3px 9px;border-radius:20px}
.tag-orange{background:rgba(92,229,219,0.08);color:var(--sesami);border:1px solid rgba(92,229,219,0.2)}
.tag-green{background:rgba(63,185,80,0.1);color:var(--accent2);border:1px solid rgba(63,185,80,0.2)}
.tag-blue{background:rgba(88,166,255,0.1);color:var(--accent3);border:1px solid rgba(88,166,255,0.2)}
.tag-purple{background:rgba(167,139,250,0.1);color:#a78bfa;border:1px solid rgba(167,139,250,0.2)}
.tag-teal{background:var(--sesami3);color:var(--sesami);border:1px solid rgba(92,229,219,0.2)}
/* PAGES - only active shown */
.page{display:none}
.page.active{display:flex;flex-direction:column;flex:1;animation:fadeUp .2s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.pi{padding:28px 36px;flex:1;overflow-y:auto}
/* CARDS */
.card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;margin-bottom:18px}
.card-title{font-family:'Instrument Serif',serif;font-size:18px;margin-bottom:4px}
.card-desc{font-size:12px;color:var(--muted)}
.card-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:18px}
/* FORMS */
.fg{display:flex;flex-direction:column;gap:5px;margin-bottom:12px}
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.lbl{font-size:11px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px}
.inp,.sel,.ta{background:rgba(255,255,255,0.04);border:1.5px solid var(--border);border-radius:8px;padding:9px 13px;color:var(--ink);font-family:'Calibri',sans-serif;font-size:14px;outline:none;transition:border-color .15s;width:100%}
.inp:focus,.sel:focus,.ta:focus{border-color:var(--sesami);background:rgba(92,229,219,0.04)}
.ta{resize:vertical;min-height:80px;line-height:1.6}
/* BUTTONS */
.btn{padding:10px 20px;border-radius:8px;font-family:'Calibri',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;border:none;display:inline-flex;align-items:center;justify-content:center;gap:7px;width:100%;margin-top:10px}
.btn-d{background:var(--sesami);color:#0d1117;font-weight:700}.btn-d:hover{opacity:.88;transform:translateY(-1px)}
.bcopy{background:rgba(92,229,219,0.08);color:var(--sesami);border:1px solid rgba(92,229,219,0.2);padding:6px 14px;border-radius:7px;font-size:12px;cursor:pointer;font-family:'DM Mono',monospace;transition:all .15s}
.bcopy:hover{background:var(--sesami);color:#0a0c10}
.bcopy.ok{background:var(--sesami);color:#0a0c10;border-color:var(--sesami)}
/* CHIPS */
.chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
.chip{padding:5px 12px;border-radius:20px;font-size:12px;cursor:pointer;border:1.5px solid var(--border);color:var(--ink2);background:rgba(255,255,255,0.04);transition:all .15s}
.chip:hover{border-color:var(--sesami);color:var(--sesami)}
.chip.on{background:rgba(92,229,219,0.12);color:var(--sesami);border-color:rgba(92,229,219,0.35)}
/* OUTPUT */
.outbox{background:rgba(255,255,255,0.02);border:1.5px solid var(--border);border-radius:10px;padding:18px;min-height:100px}
.outbox.got{border-color:rgba(92,229,219,0.3);background:rgba(92,229,219,0.04)}
.outtext{font-size:13px;line-height:1.8;color:var(--ink2);white-space:pre-wrap}
.outph{color:var(--muted);font-style:italic}
/* TEMPLATE SELECTOR */
.tgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px}
.tcard{background:rgba(255,255,255,0.03);border:1.5px solid var(--border);border-radius:10px;padding:14px;cursor:pointer;transition:all .15s}
.tcard:hover,.tcard.on{border-color:rgba(92,229,219,0.35);background:rgba(92,229,219,0.08)}
/* STATS */
.stats4{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}
.scard{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:18px}
.sval{font-family:'Instrument Serif',serif;font-size:28px;line-height:1;margin-bottom:4px}
.slbl{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace}
/* KANBAN */
.kw{padding:0 36px 36px;overflow-x:auto}
.kb{display:grid;grid-template-columns:repeat(5,minmax(190px,1fr));gap:12px}
.kcol{background:rgba(255,255,255,0.03);border:1px solid var(--border);border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px}
.kch{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}
.kct{font-size:11px;font-weight:600;font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:.5px}
.kcnt{font-size:10px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:1px 7px;color:var(--muted);font-family:'DM Mono',monospace}
.kdrop{flex:1;min-height:40px;border-radius:7px;transition:background .15s}
.kdrop.over{background:rgba(92,229,219,0.04);outline:2px dashed rgba(92,229,219,0.3);outline-offset:-2px}
.dcard{background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:12px;cursor:grab;transition:all .15s;animation:fadeUp .2s ease}
.dcard:hover{border-color:rgba(92,229,219,0.25);box-shadow:0 3px 12px rgba(0,0,0,0.3);transform:translateY(-1px)}
.dcard:active{cursor:grabbing}
.dname{font-size:13px;font-weight:600;margin-bottom:2px}
.dco{font-size:11px;color:var(--muted);font-family:'DM Mono',monospace}
.dval{font-size:12px;color:var(--accent2);font-weight:600;margin-top:6px}
.ddate{font-size:10px;color:var(--muted);font-family:'DM Mono',monospace;margin-top:3px}
.bdel{flex-shrink:0;width:21px;height:21px;background:transparent;border:1px solid var(--border);border-radius:5px;color:var(--muted);cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center;transition:all .15s}
.bdel:hover{background:#fee2e2;border-color:#fca5a5;color:#dc2626}
.badd{width:100%;background:transparent;border:1.5px dashed rgba(92,229,219,0.15);border-radius:7px;padding:7px;color:var(--muted);font-size:12px;cursor:pointer;transition:all .15s;font-family:'Calibri',sans-serif;margin-top:2px}
.badd:hover{border-color:var(--sesami);color:var(--sesami)}
/* MODAL */
.moverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(4px);z-index:200;align-items:center;justify-content:center}
.moverlay.open{display:flex}
.mdlg{background:var(--surface);border:1px solid rgba(92,229,219,0.12);border-radius:16px;padding:26px;width:430px;max-width:90vw;max-height:88vh;overflow-y:auto;animation:fadeUp .2s ease}
.mhdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.mtitle{font-family:'Instrument Serif',serif;font-size:19px}
.mclose{background:var(--surface2);border:1px solid var(--border);color:var(--muted);width:27px;height:27px;border-radius:7px;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center}
/* ROI */
.divider{height:1px;background:var(--border);margin:12px 0}
/* â•â•â• RADAR PAGE â•â•â• */
#page-radar{background:var(--r-bg);color:var(--r-text)}
.rstat-bar{display:flex;gap:1px;background:rgba(255,255,255,0.05);border-bottom:1px solid rgba(255,255,255,0.07);flex-shrink:0}
.rstat{flex:1;padding:13px 18px;background:var(--r-surface);display:flex;align-items:center;gap:10px}
.rstat-icon{font-size:15px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:7px;background:var(--r-surface2);flex-shrink:0}
.rstat-val{font-family:'Syne',sans-serif;font-size:18px;font-weight:700;line-height:1}
.rstat-lbl{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:.5px;margin-top:1px}
.rbody{display:grid;grid-template-columns:250px 1fr;flex:1;overflow:hidden;min-height:calc(100vh - 130px)}
.rsidebar{background:var(--r-surface);border-right:1px solid rgba(255,255,255,0.06);padding:18px 0;overflow-y:auto}
.rsb-sec{padding:0 14px;margin-bottom:20px}
.rsb-lbl{font-family:'DM Mono',monospace;font-size:10px;color:var(--r-muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.rsearch{width:100%;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:7px;padding:8px 11px;color:var(--r-text);font-family:'Calibri',sans-serif;font-size:12px;outline:none}
.rsearch:focus{border-color:rgba(0,229,160,.3)}
.rsearch::placeholder{color:var(--r-muted)}
.rfbtn{display:flex;align-items:center;justify-content:space-between;width:100%;padding:7px 10px;background:transparent;border:1px solid transparent;border-radius:7px;color:var(--r-text);font-family:'Calibri',sans-serif;font-size:12px;cursor:pointer;transition:all .15s;text-align:left;margin-bottom:2px}
.rfbtn:hover{background:var(--r-surface2)}
.rfbtn.on{background:rgba(0,229,160,0.08);border-color:rgba(0,229,160,0.2);color:var(--r-accent)}
.rfcount{font-family:'DM Mono',monospace;font-size:10px;background:var(--r-surface2);padding:1px 6px;border-radius:8px;color:var(--r-muted)}
.rfbtn.on .rfcount{background:rgba(0,229,160,0.15);color:var(--r-accent)}
.rpdot{width:7px;height:7px;border-radius:50%;display:inline-block;margin-right:6px}
.rcontent{padding:22px 26px;overflow-y:auto;background:var(--r-bg)}
.rctop{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
.rctitle{font-family:'Syne',sans-serif;font-size:14px;font-weight:600}
.rsort{background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);color:var(--r-text);padding:5px 9px;border-radius:7px;font-size:11px;outline:none;cursor:pointer;font-family:'Calibri',sans-serif}
.rsync{font-family:'DM Mono',monospace;font-size:10px;color:var(--r-muted)}
.rsync.sy{color:var(--r-accent)}.rsync.er{color:var(--hot)}.rsync.ld{color:var(--warm)}
.rrole{font-family:'DM Mono',monospace;font-size:10px;padding:2px 9px;border-radius:20px;border:1px solid rgba(255,165,2,0.3);background:rgba(255,165,2,0.08);color:var(--warm)}
.rrole.v{border-color:rgba(77,159,255,0.3);background:rgba(77,159,255,0.08);color:var(--cold)}
.rcards{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.rempty{text-align:center;padding:50px 20px;color:var(--r-muted);display:none}
.rempty.on{display:block}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.ldot{width:6px;height:6px;background:var(--r-accent);border-radius:50%;animation:blink 1.5s infinite;display:inline-block;margin-right:4px}
/* ACCOUNT CARDS */
.acard{background:var(--r-surface);border:1px solid rgba(255,255,255,0.06);border-radius:12px;padding:16px;transition:all .2s;position:relative;overflow:hidden;animation:fadeUp .3s ease both}
.acard:hover{border-color:rgba(0,229,160,0.2);transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,0,0,.3)}
.acard::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:12px 12px 0 0}
.acard.hot::before{background:var(--hot)}.acard.warm::before{background:var(--warm)}.acard.cold::before{background:var(--cold)}
.atop{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px}
.aavatar{width:38px;height:38px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-weight:700;font-size:13px;flex-shrink:0}
.aname{font-family:'Syne',sans-serif;font-size:13px;font-weight:600;margin-bottom:1px}
.aseg{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace}
.abadge{font-size:9px;font-family:'DM Mono',monospace;padding:2px 7px;border-radius:20px;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}
.bh{background:rgba(255,71,87,.12);color:var(--hot);border:1px solid rgba(255,71,87,.3)}
.bw{background:rgba(255,165,2,.12);color:var(--warm);border:1px solid rgba(255,165,2,.3)}
.bc{background:rgba(77,159,255,.12);color:var(--cold);border:1px solid rgba(77,159,255,.3)}
.asigs{display:flex;flex-direction:column;gap:5px;margin-bottom:10px}
.sig{display:flex;align-items:flex-start;gap:6px;padding:6px 8px;background:var(--r-surface2);border-radius:6px;border-left:2px solid transparent}
.sig.expansion{border-left-color:var(--r-accent)}.sig.news{border-left-color:var(--cold)}.sig.competitor{border-left-color:#ff6b35}
.sigicon{font-size:11px;flex-shrink:0;margin-top:1px}
.sigtext{font-size:11px;color:var(--r-text);line-height:1.4;flex:1}
.sigtime{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace;flex-shrink:0}
.afoot{display:flex;align-items:center;justify-content:space-between;padding-top:9px;border-top:1px solid rgba(255,255,255,0.06)}
.acnt{font-size:11px;color:var(--r-muted);font-family:'DM Mono',monospace}
.acnt span{color:var(--r-accent)}
.aacts{display:flex;gap:4px}
.rabtn{font-size:11px;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);color:var(--r-text);padding:4px 9px;border-radius:6px;cursor:pointer;font-family:'Calibri',sans-serif;transition:all .15s}
.rabtn:hover{border-color:var(--r-accent);color:var(--r-accent)}
.raibtn{font-size:11px;background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);padding:4px 9px;border-radius:6px;cursor:pointer;font-family:'Calibri',sans-serif;transition:all .15s}
.raibtn:hover{background:rgba(0,229,160,0.15)}
.aipanel{display:none;margin-top:9px;padding:10px;background:rgba(0,229,160,0.05);border:1px solid rgba(0,229,160,0.2);border-radius:8px}
.aipanel.on{display:block;animation:fadeUp .2s ease}
.aipanel-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:7px}
.ailbl{font-family:'DM Mono',monospace;font-size:10px;color:var(--r-accent);text-transform:uppercase;letter-spacing:1px}
.aitext{font-size:11px;line-height:1.7;color:var(--r-text);white-space:pre-wrap}
/* RADAR MODALS */
.rmoverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(4px);z-index:300;align-items:center;justify-content:center}
.rmoverlay.open{display:flex}
.rmdlg{background:var(--r-surface);border:1px solid rgba(255,255,255,0.08);border-radius:14px;padding:24px;width:460px;max-width:90vw;max-height:88vh;overflow-y:auto;animation:fadeUp .2s ease}
.rmhdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.rmtitle{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;color:var(--r-text)}
.rmclose{background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);width:27px;height:27px;border-radius:7px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px}
.rlbl{display:block;font-size:11px;font-family:'DM Mono',monospace;color:var(--r-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.rinp,.rsel,.rta{width:100%;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:8px;padding:8px 11px;color:var(--r-text);font-family:'Calibri',sans-serif;font-size:13px;outline:none;transition:border-color .2s;margin-bottom:10px}
.rinp:focus,.rsel:focus{border-color:rgba(0,229,160,.35)}
.rsel option{background:var(--r-surface2)}
.rfrow{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.rsubmit{width:100%;background:var(--r-accent);color:#0a0c10;border:none;padding:10px;border-radius:8px;font-family:'Syne',sans-serif;font-size:14px;font-weight:700;cursor:pointer;margin-top:6px}
.rsubmit:hover{opacity:.85}
.rdrop{border:2px dashed rgba(77,159,255,0.3);border-radius:10px;padding:24px;text-align:center;cursor:pointer;transition:all .2s;margin-bottom:12px}
.rdrop:hover,.rdrop.over{border-color:var(--r-accent);background:rgba(0,229,160,0.04)}
.rprev{width:100%;border-collapse:collapse;font-size:11px;margin-bottom:12px;max-height:150px;overflow-y:auto;display:block}
.rprev th{background:var(--r-surface2);color:var(--r-muted);font-family:'DM Mono',monospace;text-transform:uppercase;font-size:10px;padding:5px 9px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.07);position:sticky;top:0}
.rprev td{padding:5px 9px;border-bottom:1px solid rgba(255,255,255,0.05);color:var(--r-text)}
.risum{display:flex;gap:8px;margin-bottom:12px}
.ristat{flex:1;background:var(--r-surface2);border-radius:7px;padding:8px;text-align:center}
.ristatv{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;color:var(--r-accent)}
.ristatl{font-size:10px;color:var(--r-muted);font-family:'DM Mono',monospace;margin-top:1px}
/* ROLE SCREEN */
.rscreen{display:none;position:fixed;inset:0;background:rgba(10,12,16,0.96);z-index:400;align-items:center;justify-content:center;backdrop-filter:blur(8px)}
.rscreen.open{display:flex}
.rbox{background:var(--r-surface);border:1px solid rgba(255,255,255,0.08);border-radius:18px;padding:30px;width:340px;text-align:center}
.rbox-title{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:var(--r-text);margin-bottom:4px}
.rbox-sub{color:var(--r-muted);font-size:12px;margin-bottom:22px}
.rbtns{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.rbtn{padding:16px 10px;background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:10px;color:var(--r-text);cursor:pointer;transition:all .2s;text-align:center}
.rbtn:hover{border-color:rgba(0,229,160,0.4)}
.rbtn-icon{font-size:24px;display:block;margin-bottom:6px}
.rbtn strong{display:block;font-family:'Syne',sans-serif;font-size:13px;margin-bottom:2px}
.rbtn span{font-size:11px;color:var(--r-muted)}
/* TOAST */
.toast{position:fixed;bottom:24px;right:24px;background:var(--ink);color:#fff;padding:11px 18px;border-radius:10px;font-size:13px;z-index:999;transform:translateY(80px);transition:transform .3s ease;font-family:'Calibri',sans-serif}
.toast.on{transform:translateY(0)}
::-webkit-scrollbar{width:4px;height:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE RESPONSIVO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

.mob-brand { display: none; }
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MOBILE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {

  /* Shell: 1 coluna, nav embaixo */
  .shell { grid-template-columns: 1fr; }

  /* Nav vira barra inferior fixa */
  .nav {
    position: fixed;
    bottom: 0; left: 0; right: 0; top: auto;
    height: 64px;
    flex-direction: row;
    overflow-x: auto;
    border-top: 1px solid rgba(92,229,219,0.1);
    background: #0d1117;
    z-index: 100;
  }
  .nav-brand, .nav-footer, .nav-section { display: none !important; }
  .nav-items {
    display: flex;
    flex-direction: row;
    padding: 6px 4px;
    flex: 1;
    overflow-x: auto;
    gap: 2px;
  }
  .nav-item {
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 6px 8px;
    gap: 2px;
    min-width: 58px;
    font-size: 10px;
    text-align: center;
    flex-shrink: 0;
    border-radius: 10px;
  }
  .ni-icon { width: 22px; height: 22px; font-size: 12px; }

  /* Main area recua para nÃ£o ficar atrÃ¡s do nav */
  .main-area { padding-bottom: 70px; }

  /* Topbar menor */
  .topbar { padding: 0 14px; height: 56px; justify-content: space-between; }
  .topbar-title { display: none; }
  .mob-brand { display: flex; flex-direction: column; justify-content: center; }

  /* Pages padding menor */
  .pi { padding: 14px 12px; }

  /* FormulÃ¡rios: 2 colunas â†’ 1 coluna */
  .fg2 { grid-template-columns: 1fr !important; }

  /* Grids inline de 2 colunas â†’ 1 coluna */
  .card > div[style*="grid-template-columns"],
  .pi > div[style*="grid-template-columns"] {
    display: flex !important;
    flex-direction: column !important;
    gap: 14px !important;
  }

  /* Cards */
  .card { padding: 14px; margin-bottom: 14px; }
  .card-title { font-size: 15px; }

  /* Template grid 2x2 ok no mobile */
  .tgrid { grid-template-columns: 1fr 1fr; gap: 8px; }

  /* Stats 4 â†’ 2x2 */
  .stats4 { grid-template-columns: 1fr 1fr; gap: 10px; }
  .sval { font-size: 22px; }

  /* Kanban: scroll horizontal */
  .kw { padding: 0 12px 12px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
  .kb { display: flex; gap: 10px; width: max-content; }
  .kcol { width: 200px; flex-shrink: 0; }

  /* Modals */
  .mdlg, .rmdlg {
    width: 96vw;
    max-width: 96vw;
    padding: 18px 14px;
    max-height: 82vh;
    border-radius: 14px;
  }

  /* Radar stats: 2x2 + aÃ§Ãµes full width */
  .rstat-bar { flex-wrap: wrap; }
  .rstat { flex: 1 1 50%; min-width: 50%; padding: 10px 12px; }
  .rstat:last-child { flex: 1 1 100%; }
  #radmin-btns { flex-wrap: wrap; }

  /* Radar body: esconde sidebar, conteÃºdo full */
  .rbody { grid-template-columns: 1fr !important; }
  .rsidebar { display: none; }
  .rsidebar.mob-open {
    display: block;
    position: fixed;
    top: 50px; left: 0; right: 0; bottom: 64px;
    overflow-y: auto;
    z-index: 90;
    background: var(--r-surface);
    padding: 16px 0;
  }
  .rcontent { padding: 14px 12px; }
  .rcards { grid-template-columns: 1fr; }
  .rctop { flex-direction: column; align-items: flex-start; gap: 8px; }

  /* BotÃ£o filtros radar */
  #r-mob-filters { display: inline-flex !important; }
}

@media (max-width: 380px) {
  .nav-item span { display: none; }
  .nav-item { min-width: 44px; }
  .tgrid { grid-template-columns: 1fr; }
}


</style>
</head>
<body>
<div class="shell">
  <!-- NAV -->
  <nav class="nav">
    <div class="nav-brand">
      <div class="nav-brand-name">Nelson<br><span style="color:var(--sesami)">SESAMI</span></div>
      <div class="nav-brand-sub">by Nelson Lima</div>
    </div>
    <div class="nav-items">
      <div class="nav-section">Ferramentas</div>
      <div class="nav-item active" onclick="goTo('followup',this)">
        <div class="ni-icon">âœ‰ï¸</div><span>Follow-up</span>
      </div>
      <div class="nav-item" onclick="goTo('prospeccao',this)">
        <div class="ni-icon">ğŸ¯</div><span>ProspecÃ§Ã£o</span>
      </div>
      <div class="nav-item" onclick="goTo('roi',this)">
        <div class="ni-icon">ğŸ“Š</div><span>Calculadora ROI</span>
      </div>
      <div class="nav-item" onclick="goTo('pipeline',this)">
        <div class="ni-icon">ğŸ“‹</div><span>Pipeline</span>
      </div>
      <div class="nav-item" onclick="goTo('radar',this)">
        <div class="ni-icon">ğŸ“¡</div><span>Radar de Contas</span>
      </div>
    </div>
    <div class="nav-footer">
      <div class="nav-user"><strong>Nelson Lima</strong>Varejo Alimentar</div>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main-area">
    <div class="topbar">
      <div class="mob-brand" id="mob-brand">
        <div style="font-family:'Instrument Serif',serif;font-size:17px;color:var(--ink);line-height:1.1">Nelson <span style="color:var(--sesami)">SESAMI</span></div>
        <div style="font-size:9px;color:var(--muted);font-family:'DM Mono',monospace;text-transform:uppercase;letter-spacing:1px">by Nelson Lima</div>
      </div>
      <div class="topbar-title" id="tt">E-mail de Follow-up</div>
      <span class="tag tag-orange" id="tg">ComunicaÃ§Ã£o</span>
    </div>

    <!-- FOLLOW-UP -->
    <div class="page active" id="page-followup">
      <div class="pi">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div class="card">
            <div class="card-header"><div><div class="card-title">Contexto da ReuniÃ£o</div><div class="card-desc">Preencha para gerar o e-mail</div></div></div>
            <div class="fg2">
              <div class="fg"><label class="lbl">Empresa</label><input class="inp" id="fu-empresa" placeholder="Ex: Grupo PÃ£o de AÃ§Ãºcar"></div>
              <div class="fg"><label class="lbl">Contato</label><input class="inp" id="fu-contato" placeholder="Ex: Ricardo Silva"></div>
            </div>
            <div class="fg"><label class="lbl">Cargo</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'fu-cargo')">CEO / Dono</div>
                <div class="chip" onclick="sc(this,'fu-cargo')">Gerente de TI</div>
                <div class="chip" onclick="sc(this,'fu-cargo')">Gerente de OperaÃ§Ãµes</div>
                <div class="chip" onclick="sc(this,'fu-cargo')">Diretor Comercial</div>
              </div><input type="hidden" id="fu-cargo" value="CEO / Dono">
            </div>
            <div class="fg"><label class="lbl">O que foi discutido?</label><textarea class="ta" id="fu-disc" placeholder="Ex: Apresentamos soluÃ§Ã£o de gestÃ£o de estoque..."></textarea></div>
            <div class="fg"><label class="lbl">Principal objeÃ§Ã£o</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'fu-obj')">PreÃ§o alto</div>
                <div class="chip" onclick="sc(this,'fu-obj')">Prazo de implementaÃ§Ã£o</div>
                <div class="chip" onclick="sc(this,'fu-obj')">Precisa aprovar internamente</div>
                <div class="chip" onclick="sc(this,'fu-obj')">JÃ¡ tem soluÃ§Ã£o</div>
                <div class="chip" onclick="sc(this,'fu-obj')">Nenhuma</div>
              </div><input type="hidden" id="fu-obj" value="PreÃ§o alto">
            </div>
            <div class="fg"><label class="lbl">PrÃ³ximo passo combinado</label><input class="inp" id="fu-prox" placeholder="Ex: Enviar proposta atÃ© sexta-feira"></div>
            <div class="fg"><label class="lbl">Tom</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'fu-tom')">Direto e objetivo</div>
                <div class="chip" onclick="sc(this,'fu-tom')">Consultivo</div>
                <div class="chip" onclick="sc(this,'fu-tom')">UrgÃªncia suave</div>
              </div><input type="hidden" id="fu-tom" value="Direto e objetivo">
            </div>
            <button class="btn btn-d" onclick="gerarFU()">âœ‰ï¸ Gerar E-mail</button>
          </div>
          <div class="card" style="display:flex;flex-direction:column">
            <div class="card-header"><div><div class="card-title">E-mail Gerado</div><div class="card-desc">Pronto para copiar e enviar</div></div><button class="bcopy" id="bcp-fu" onclick="cp('fu-out','bcp-fu')">Copiar</button></div>
            <div class="outbox" id="fu-box" style="flex:1"><div class="outtext outph" id="fu-out">Preencha os dados ao lado e clique em "Gerar E-mail".</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROSPECÃ‡ÃƒO -->
    <div class="page" id="page-prospeccao">
      <div class="pi">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
          <div class="card">
            <div class="card-header"><div><div class="card-title">Mensagem de ProspecÃ§Ã£o</div><div class="card-desc">Personalizada por canal</div></div></div>
            <div class="tgrid">
              <div class="tcard on" id="tpl-email" onclick="selTpl('email')"><div style="font-size:18px;margin-bottom:6px">âœ‰ï¸</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">E-mail frio</div><div style="font-size:11px;color:var(--muted)">Primeiro contato</div></div>
              <div class="tcard" id="tpl-linkedin" onclick="selTpl('linkedin')"><div style="font-size:18px;margin-bottom:6px">ğŸ’¼</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">LinkedIn</div><div style="font-size:11px;color:var(--muted)">Mensagem de conexÃ£o</div></div>
              <div class="tcard" id="tpl-whatsapp" onclick="selTpl('whatsapp')"><div style="font-size:18px;margin-bottom:6px">ğŸ’¬</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">WhatsApp</div><div style="font-size:11px;color:var(--muted)">Abordagem direta</div></div>
              <div class="tcard" id="tpl-indicacao" onclick="selTpl('indicacao')"><div style="font-size:18px;margin-bottom:6px">ğŸ¤</div><div style="font-size:13px;font-weight:600;margin-bottom:2px">Por indicaÃ§Ã£o</div><div style="font-size:11px;color:var(--muted)">Com nome em comum</div></div>
            </div>
            <input type="hidden" id="pr-tipo" value="email">
            <div class="fg2">
              <div class="fg"><label class="lbl">Empresa alvo</label><input class="inp" id="pr-empresa" placeholder="Ex: Rede NordestÃ£o"></div>
              <div class="fg"><label class="lbl">Nome do decisor</label><input class="inp" id="pr-contato" placeholder="Ex: Ana Ferreira"></div>
            </div>
            <div class="fg"><label class="lbl">Cargo</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'pr-cargo')">CEO / Dono</div>
                <div class="chip" onclick="sc(this,'pr-cargo')">Gerente de TI</div>
                <div class="chip" onclick="sc(this,'pr-cargo')">Gerente de OperaÃ§Ãµes</div>
                <div class="chip" onclick="sc(this,'pr-cargo')">Diretor Comercial</div>
              </div><input type="hidden" id="pr-cargo" value="CEO / Dono">
            </div>
            <div class="fg"><label class="lbl">Gatilho</label>
              <div class="chips">
                <div class="chip on" onclick="sc(this,'pr-gatilho')">ExpansÃ£o de lojas</div>
                <div class="chip" onclick="sc(this,'pr-gatilho')">Abertura de mercado</div>
                <div class="chip" onclick="sc(this,'pr-gatilho')">Troca de sistema</div>
                <div class="chip" onclick="sc(this,'pr-gatilho')">Sem motivo especÃ­fico</div>
              </div><input type="hidden" id="pr-gatilho" value="ExpansÃ£o de lojas">
            </div>
            <div class="fg" id="pr-ind-grp" style="display:none"><label class="lbl">Quem indicou</label><input class="inp" id="pr-ind" placeholder="Ex: JoÃ£o Mendes"></div>
            <button class="btn btn-d" onclick="gerarPR()">ğŸ¯ Gerar Mensagem</button>
          </div>
          <div class="card" style="display:flex;flex-direction:column">
            <div class="card-header"><div><div class="card-title">Mensagem Gerada</div><div class="card-desc">Edite antes de enviar</div></div><button class="bcopy" id="bcp-pr" onclick="cp('pr-out','bcp-pr')">Copiar</button></div>
            <div class="outbox" id="pr-box" style="flex:1"><div class="outtext outph" id="pr-out">Escolha o canal e preencha os dados para gerar.</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ROI -->
    <div class="page" id="page-roi">
      <div class="pi">
        <div style="display:grid;grid-template-columns:330px 1fr;gap:20px;align-items:start">
          <div>
            <div class="card">
              <div class="card-header"><div><div class="card-title">Dados do Projeto</div><div class="card-desc">Preencha para calcular</div></div></div>
              <div style="background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:13px;margin-bottom:12px">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:9px">Projeto / SoluÃ§Ã£o</div>
                <div class="fg"><label class="lbl">Nome do projeto</label><input class="inp" id="roi-proj" placeholder="Ex: Projeto Gatecash" oninput="calcROI()"></div>
                <div class="fg2">
                  <div class="fg"><label class="lbl">CAPEX (compra)</label><input class="inp" id="roi-capex" placeholder="R$ 0,00" oninput="mR(this);calcROI()"></div>
                  <div class="fg"><label class="lbl">OPEX (locaÃ§Ã£o/mÃªs)</label><input class="inp" id="roi-opex" placeholder="R$ 0,00" oninput="mR(this);calcROI()"></div>
                </div>
              </div>
              <div style="background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:13px;margin-bottom:12px">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:9px">Dados do Cliente</div>
                <div class="fg2">
                  <div class="fg"><label class="lbl">NÂº de PDVs</label><input class="inp" id="roi-pdvs" type="number" placeholder="Ex: 10" oninput="calcROI()"></div>
                  <div class="fg"><label class="lbl">Fat. mensal por PDV</label><input class="inp" id="roi-fat" placeholder="R$ 0,00" oninput="mR(this);calcROI()"><div style="font-size:10px;color:var(--muted);margin-top:2px">Ref: R$350kâ€“R$500k</div></div>
                </div>
              </div>
              <div style="background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:13px">
                <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:9px">Perdas e Meta</div>
                <div class="fg2">
                  <div class="fg"><label class="lbl">Perdas totais (%)</label><input class="inp" id="roi-ptot" type="number" placeholder="Ex: 1.82" step="0.01" oninput="calcROI()"></div>
                  <div class="fg"><label class="lbl">Perdas nÃ£o identificadas (%)</label><input class="inp" id="roi-pni" type="number" placeholder="Ex: 42" step="0.01" oninput="calcROI()"><div style="font-size:10px;color:var(--muted);margin-top:2px">% das perdas totais</div></div>
                </div>
                <div class="fg"><label class="lbl">Meta de reduÃ§Ã£o (%)</label><input class="inp" id="roi-meta" type="number" placeholder="Ex: 30" step="1" oninput="calcROI()"><div style="font-size:10px;color:var(--muted);margin-top:2px">% das perdas nÃ£o identificadas que a soluÃ§Ã£o reduz</div></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-title">Resultado</div></div>
            <div id="roi-res"><div style="text-align:center;padding:50px;color:var(--muted);font-style:italic;font-size:13px">Preencha os dados ao lado para calcular</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- PIPELINE -->
    <div class="page" id="page-pipeline">
      <div class="pi" style="padding-bottom:0">
        <div class="stats4">
          <div class="scard"><div class="sval" id="pt">0</div><div class="slbl">Oportunidades</div></div>
          <div class="scard"><div class="sval" style="color:var(--accent2)" id="pv">R$ 0</div><div class="slbl">Valor total</div></div>
          <div class="scard"><div class="sval" style="color:var(--accent)" id="ph">0</div><div class="slbl">Em negociaÃ§Ã£o</div></div>
          <div class="scard"><div class="sval" style="color:var(--gold)" id="pf">R$ 0</div><div class="slbl">Fechado</div></div>
        </div>
      </div>
      <div class="kw">
        <div class="kb">
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--muted)">ProspecÃ§Ã£o</span><span class="kcnt" id="cnt-prospeccao">0</span></div><div class="kdrop" id="col-prospeccao" ondragover="dov(event)" ondrop="dp(event,'prospeccao')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('prospeccao')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--accent3)">QualificaÃ§Ã£o</span><span class="kcnt" id="cnt-qualificacao">0</span></div><div class="kdrop" id="col-qualificacao" ondragover="dov(event)" ondrop="dp(event,'qualificacao')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('qualificacao')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--accent)">Proposta</span><span class="kcnt" id="cnt-proposta">0</span></div><div class="kdrop" id="col-proposta" ondragover="dov(event)" ondrop="dp(event,'proposta')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('proposta')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--gold)">NegociaÃ§Ã£o</span><span class="kcnt" id="cnt-negociacao">0</span></div><div class="kdrop" id="col-negociacao" ondragover="dov(event)" ondrop="dp(event,'negociacao')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('negociacao')">+ Adicionar</button></div>
          <div class="kcol"><div class="kch"><span class="kct" style="color:var(--accent2)">Fechado âœ“</span><span class="kcnt" id="cnt-fechado">0</span></div><div class="kdrop" id="col-fechado" ondragover="dov(event)" ondrop="dp(event,'fechado')" ondragleave="dlv(event)"></div><button class="badd" onclick="openDM('fechado')">+ Adicionar</button></div>
        </div>
      </div>
    </div>

    <!-- RADAR -->
    <div class="page" id="page-radar">
      <div class="rstat-bar">
        <div class="rstat"><div class="rstat-icon">ğŸ¢</div><div><div class="rstat-val" id="r-tot">0</div><div class="rstat-lbl">Contas</div></div></div>
        <div class="rstat"><div class="rstat-icon">ğŸ”¥</div><div><div class="rstat-val" id="r-hot" style="color:var(--hot)">0</div><div class="rstat-lbl">Quentes</div></div></div>
        <div class="rstat"><div class="rstat-icon">ğŸ“¡</div><div><div class="rstat-val" id="r-sig" style="color:var(--r-accent)">0</div><div class="rstat-lbl">Sinais</div></div></div>
        <div class="rstat"><div class="rstat-icon">âš¡</div><div><div class="rstat-val" id="r-opp" style="color:var(--warm)">0</div><div class="rstat-lbl">Oportunidades</div></div></div>
        <div class="rstat" style="flex:2">
          <div style="width:100%">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:5px"><div class="ldot"></div><span class="rsync" id="rsync">conectando...</span></div>
            <div style="display:flex;align-items:center;gap:6px;margin-bottom:5px">
              <button id="r-filter-btn" class="r-filter-toggle" style="display:none;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);color:var(--r-text);padding:4px 10px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Calibri',sans-serif" onclick="toggleRSidebar()">âš™ï¸ Filtros</button>
            </div>
            <div id="radmin-btns" style="display:flex;gap:6px;flex-wrap:wrap">
              <button onclick="openRM()" style="background:var(--r-accent);color:#0a0c10;border:none;padding:4px 11px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Calibri',sans-serif;font-weight:600">+ Nova Conta</button>
              <button onclick="openRI()" style="background:transparent;color:var(--cold);border:1px solid rgba(77,159,255,0.3);padding:4px 11px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Calibri',sans-serif">ğŸ“¥ Importar</button>
              <button onclick="rExcel()" style="background:transparent;color:var(--r-muted);border:1px solid rgba(255,255,255,0.07);padding:4px 11px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Calibri',sans-serif">ğŸ“Š Excel</button>
            </div>
          </div>
        </div>
      </div>
      <div class="rbody">
        <aside class="rsidebar">
          <div class="rsb-sec"><div class="rsb-lbl">Buscar</div><input class="rsearch" type="text" placeholder="Buscar empresa..." id="rsearch" oninput="rFilt()"></div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Prioridade</div>
            <button class="rfbtn on" onclick="rSF('all',this)">Todas <span class="rfcount" id="r-call">0</span></button>
            <button class="rfbtn" onclick="rSF('hot',this)"><span><span class="rpdot" style="background:var(--hot)"></span>Quente</span><span class="rfcount" id="r-chot">0</span></button>
            <button class="rfbtn" onclick="rSF('warm',this)"><span><span class="rpdot" style="background:var(--warm)"></span>Morno</span><span class="rfcount" id="r-cwarm">0</span></button>
            <button class="rfbtn" onclick="rSF('cold',this)"><span><span class="rpdot" style="background:var(--cold)"></span>Frio</span><span class="rfcount" id="r-ccold">0</span></button>
          </div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Sinais</div>
            <button class="rfbtn" onclick="rSSig('expansion',this)">ğŸ—ï¸ ExpansÃ£o de lojas</button>
            <button class="rfbtn" onclick="rSSig('news',this)">ğŸ“° NotÃ­cias e mÃ­dia</button>
            <button class="rfbtn" onclick="rSSig('competitor',this)">âš”ï¸ Concorrentes</button>
          </div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Segmento</div>
            <button class="rfbtn" onclick="rSSeg('all',this)">Todos</button>
            <button class="rfbtn" onclick="rSSeg('Supermercados',this)">Supermercados</button>
            <button class="rfbtn" onclick="rSSeg('FarmÃ¡cias',this)">FarmÃ¡cias</button>
            <button class="rfbtn" onclick="rSSeg('Moda',this)">Moda</button>
            <button class="rfbtn" onclick="rSSeg('EletrÃ´nicos',this)">EletrÃ´nicos</button>
            <button class="rfbtn" onclick="rSSeg('Home Center',this)">Home Center</button>
          </div>
          <div class="rsb-sec">
            <div class="rsb-lbl">Conta</div>
            <button class="rfbtn" onclick="rSwitch()" style="color:var(--r-muted)">ğŸ”„ Trocar perfil</button>
          </div>
        </aside>
        <main class="rcontent">
          <div class="rctop">
            <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
              <div class="rctitle" id="r-sec-title">Todas as Contas</div>
              <span class="rrole" id="r-role-badge">ğŸ‘‘ Admin</span>
              <button id="r-mob-filters" onclick="toggleRSidebar()" style="display:none;background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.25);color:var(--r-accent);padding:4px 10px;border-radius:6px;font-size:11px;cursor:pointer;font-family:'Calibri',sans-serif;align-items:center;gap:4px">âš™ï¸ Filtros</button>
            </div>
            <select class="rsort" onchange="rSortC(this.value)">
              <option value="priority">Prioridade</option>
              <option value="name">Nome A-Z</option>
              <option value="signals">Mais sinais</option>
            </select>
          </div>
          <div class="rcards" id="rcards"></div>
          <div class="rempty" id="rempty"><div style="font-size:34px;margin-bottom:8px">ğŸ“¡</div><p>Nenhuma conta ainda.</p></div>
        </main>
      </div>
    </div>

  </div><!-- /main-area -->
</div><!-- /shell -->

<!-- ROLE PICKER -->
<div class="rscreen" id="rscreen">
  <div class="rbox">
    <div style="font-size:30px;margin-bottom:12px">ğŸ“¡</div>
    <div class="rbox-title">Radar de Contas</div>
    <div class="rbox-sub">Como vocÃª vai usar?</div>
    <div class="rbtns">
      <button class="rbtn" onclick="rEnter('admin')"><span class="rbtn-icon">ğŸ‘‘</span><strong>Admin</strong><span>Gerencio e edito</span></button>
      <button class="rbtn" onclick="rEnter('viewer')"><span class="rbtn-icon">ğŸ‘ï¸</span><strong>Visualizador</strong><span>SÃ³ visualizo</span></button>
    </div>
  </div>
</div>

<!-- MODAL NOVA CONTA RADAR -->
<div class="rmoverlay" id="rm-modal" onclick="if(event.target===this)closeRM()">
  <div class="rmdlg">
    <div class="rmhdr"><div class="rmtitle" id="rm-title">Nova Conta</div><button class="rmclose" onclick="closeRM()">âœ•</button></div>
    <label class="rlbl">Nome da empresa *</label>
    <div style="display:flex;gap:8px;margin-bottom:10px">
      <input class="rinp" id="rf-name" placeholder="Ex: Grupo PÃ£o de AÃ§Ãºcar" style="margin:0;flex:1">
      <button onclick="rAutofill()" style="background:rgba(0,229,160,0.1);border:1px solid rgba(0,229,160,0.3);color:var(--r-accent);padding:0 12px;border-radius:8px;cursor:pointer;font-size:13px;white-space:nowrap;flex-shrink:0">âœ¨ IA</button>
    </div>
    <div class="rfrow">
      <div><label class="rlbl">Segmento</label><select class="rsel" id="rf-seg"><option value="">Selecione...</option><option>Supermercados</option><option>FarmÃ¡cias</option><option>Moda</option><option>EletrÃ´nicos</option><option>Home Center</option><option>Outros</option></select></div>
      <div><label class="rlbl">Prioridade</label><select class="rsel" id="rf-pri"><option value="cold">ğŸ”µ Frio</option><option value="warm">ğŸŸ¡ Morno</option><option value="hot">ğŸ”´ Quente</option></select></div>
    </div>
    <label class="rlbl">NÂº de lojas</label><input class="rinp" id="rf-stores" type="number" placeholder="Ex: 45">
    <label class="rlbl">Sinal inicial</label><input class="rinp" id="rf-sigtxt" placeholder="Ex: Inaugurou 3 lojas em SP">
    <label class="rlbl">Tipo do sinal</label><select class="rsel" id="rf-sigtyp"><option value="expansion">ğŸ—ï¸ ExpansÃ£o</option><option value="news">ğŸ“° NotÃ­cia</option><option value="competitor">âš”ï¸ Concorrente</option></select>
    <button class="rsubmit" onclick="rAddAcc()">Adicionar ao Radar</button>
  </div>
</div>

<!-- MODAL IMPORTAR -->
<div class="rmoverlay" id="ri-modal" onclick="if(event.target===this)closeRI()">
  <div class="rmdlg" style="width:500px">
    <div class="rmhdr"><div class="rmtitle">ğŸ“¥ Importar Contas</div><button class="rmclose" onclick="closeRI()">âœ•</button></div>
    <div id="ri-s1">
      <div style="background:var(--r-surface2);border:1px solid rgba(255,255,255,0.07);border-radius:9px;padding:12px;margin-bottom:10px">
        <div style="font-size:10px;font-family:'DM Mono',monospace;color:var(--r-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:7px">Colunas esperadas</div>
        <div style="display:flex;gap:5px;flex-wrap:wrap">
          <span style="background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Nome</span>
          <span style="background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Segmento</span>
          <span style="background:rgba(0,229,160,0.08);border:1px solid rgba(0,229,160,0.2);color:var(--r-accent);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Prioridade</span>
          <span style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Lojas</span>
          <span style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Sinal</span>
          <span style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);font-family:'DM Mono',monospace;font-size:10px;padding:2px 7px;border-radius:5px">Tipo Sinal</span>
        </div>
      </div>
      <button onclick="rDlTpl()" style="width:100%;background:transparent;color:var(--cold);border:1px dashed rgba(77,159,255,0.3);padding:8px;border-radius:7px;font-size:12px;cursor:pointer;margin-bottom:10px;font-family:'Calibri',sans-serif">â¬‡ï¸ Baixar planilha modelo</button>
      <div class="rdrop" id="rdrop" onclick="document.getElementById('rfile').click()" ondragover="rDov(event)" ondragleave="rDlv(event)" ondrop="rDdrop(event)">
        <div style="font-size:26px;margin-bottom:7px">ğŸ“‚</div>
        <div style="font-size:12px;color:var(--r-muted)"><strong style="color:var(--cold)">Clique</strong> ou arraste aqui â€” .xlsx, .xls ou .csv</div>
      </div>
      <input type="file" id="rfile" accept=".xlsx,.xls,.csv" style="display:none" onchange="rHF(event)">
    </div>
    <div id="ri-s2" style="display:none">
      <div class="risum" id="risum"></div>
      <div style="font-family:'DM Mono',monospace;font-size:10px;color:var(--r-muted);text-transform:uppercase;margin-bottom:7px">PrÃ©-visualizaÃ§Ã£o</div>
      <table class="rprev" id="rprev"></table>
      <button class="rsubmit" onclick="rConfirmI()">âœ… Confirmar ImportaÃ§Ã£o</button>
      <button onclick="rResetI()" style="width:100%;background:transparent;border:1px solid rgba(255,255,255,0.07);color:var(--r-muted);padding:8px;border-radius:7px;font-size:12px;cursor:pointer;margin-top:7px;font-family:'Calibri',sans-serif">â† Voltar</button>
    </div>
  </div>
</div>

<!-- DEAL MODAL -->
<div class="moverlay" id="dm" onclick="if(event.target===this)closeDM()">
  <div class="mdlg">
    <div class="mhdr"><div class="mtitle">Nova Oportunidade</div><button class="mclose" onclick="closeDM()">âœ•</button></div>
    <div class="fg2">
      <div class="fg"><label class="lbl">Empresa</label><input class="inp" id="d-emp" placeholder="Ex: Supermercado X"></div>
      <div class="fg"><label class="lbl">Contato</label><input class="inp" id="d-cont" placeholder="Ex: JoÃ£o Silva"></div>
    </div>
    <div class="fg2">
      <div class="fg"><label class="lbl">Valor estimado (R$)</label><input class="inp" id="d-val" type="number" placeholder="Ex: 50000"></div>
      <div class="fg"><label class="lbl">PrevisÃ£o de fechamento</label><input class="inp" id="d-data" type="date"></div>
    </div>
    <div class="fg"><label class="lbl">ObservaÃ§Ãµes</label><textarea class="ta" id="d-obs" style="min-height:60px" placeholder="Notas..."></textarea></div>
    <button class="btn btn-d" onclick="saveDeal()">Adicionar ao Pipeline</button>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var PAGES = {
  followup:   {t:'E-mail de Follow-up',   c:'tag-orange', lbl:'ComunicaÃ§Ã£o'},
  prospeccao: {t:'Gerador de ProspecÃ§Ã£o', c:'tag-blue',   lbl:'ProspecÃ§Ã£o'},
  roi:        {t:'Calculadora de ROI',    c:'tag-green',  lbl:'Proposta de Valor'},
  pipeline:   {t:'Pipeline de Vendas',    c:'tag-purple', lbl:'GestÃ£o'},
  radar:      {t:'Radar de Contas',       c:'tag-teal',   lbl:'InteligÃªncia'}
};

function goTo(page, el) {
  var pages = document.querySelectorAll('.page');
  for (var i = 0; i < pages.length; i++) pages[i].classList.remove('active');
  var navs = document.querySelectorAll('.nav-item');
  for (var i = 0; i < navs.length; i++) navs[i].classList.remove('active');
  document.getElementById('page-' + page).classList.add('active');
  if (el) el.classList.add('active');
  var p = PAGES[page];
  document.getElementById('tt').textContent = p.t;
  var tag = document.getElementById('tg');
  tag.className = 'tag ' + p.c;
  tag.textContent = p.lbl;
  if (page === 'radar') initRadar();
  if (page === 'pipeline') renderP();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHIPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function sc(el, id) {
  var chips = el.closest('.chips').querySelectorAll('.chip');
  for (var i = 0; i < chips.length; i++) chips[i].classList.remove('on');
  el.classList.add('on');
  document.getElementById(id).value = el.textContent.trim();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TEMPLATE SELECTOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function selTpl(t) {
  var cards = document.querySelectorAll('.tcard');
  for (var i = 0; i < cards.length; i++) cards[i].classList.remove('on');
  document.getElementById('tpl-' + t).classList.add('on');
  document.getElementById('pr-tipo').value = t;
  document.getElementById('pr-ind-grp').style.display = t === 'indicacao' ? 'flex' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FOLLOW-UP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gerarFU() {
  var emp   = document.getElementById('fu-empresa').value.trim() || 'a empresa';
  var con   = document.getElementById('fu-contato').value.trim() || 'prezado(a)';
  var disc  = document.getElementById('fu-disc').value.trim();
  var obj   = document.getElementById('fu-obj').value;
  var prox  = document.getElementById('fu-prox').value.trim();
  var tom   = document.getElementById('fu-tom').value;
  var cargo = document.getElementById('fu-cargo').value;
  var nome  = con.split(' ')[0];

  var abertura;
  if (cargo === 'Gerente de TI')
    abertura = nome + ', foi uma conversa muito produtiva. Raramente encontro um ' + cargo + ' com visÃ£o tÃ£o clara dos gargalos operacionais.';
  else if (cargo === 'Gerente de OperaÃ§Ãµes')
    abertura = nome + ', gostei muito da franqueza na conversa. Poucos gestores de operaÃ§Ãµes falam abertamente sobre onde a operaÃ§Ã£o sangra.';
  else if (cargo === 'Diretor Comercial')
    abertura = nome + ', obrigado pelo tempo. Fica claro que vocÃª conhece a fundo os nÃºmeros da operaÃ§Ã£o.';
  else
    abertura = nome + ', obrigado pela conversa de hoje.';

  var contexto;
  if (disc)
    contexto = 'Ficou claro que ' + disc.substring(0, 120) + (disc.length > 120 ? '...' : '') + ' â€” e esse ponto Ã© onde tenho visto as maiores oportunidades de resultado nas operaÃ§Ãµes com que trabalho.';
  else
    contexto = 'Com base no que conversamos, identifico pontos concretos onde podemos gerar resultado mensurÃ¡vel para a ' + emp + '.';

  var objTxt;
  if (obj === 'PreÃ§o alto')
    objTxt = 'Sobre o investimento: entendo a cautela, e Ã© legÃ­tima. Mas quero ser direto â€” em 20 anos trabalhando com varejo alimentar, o que mais vi foi operaÃ§Ã£o perdendo dinheiro por falta de visibilidade. Vou te mandar um modelo de ROI com os nÃºmeros da ' + emp + '. Se nÃ£o fechar conta em menos de 8 meses, a conversa para por aÃ­.';
  else if (obj === 'Prazo de implementaÃ§Ã£o')
    objTxt = 'Sobre o prazo: isso Ã© resolvÃ­vel. Trabalhamos com implantaÃ§Ã£o modular â€” os primeiros PDVs entram em operaÃ§Ã£o em 3 a 4 semanas, sem virar a operaÃ§Ã£o de cabeÃ§a para baixo. JÃ¡ fizemos isso em redes com mais de 80 lojas sem parar um caixa sequer.';
  else if (obj === 'Precisa aprovar internamente')
    objTxt = 'Perfeito â€” Ã© assim que deve ser. Vou preparar um material executivo com os trÃªs argumentos que costumam definir a aprovaÃ§Ã£o: impacto em perda, payback e risco de nÃ£o agir. VocÃª me diz o formato que funciona melhor para quem vai aprovar.';
  else if (obj === 'JÃ¡ tem soluÃ§Ã£o')
    objTxt = 'Entendo. E nÃ£o estou aqui para te convencer a trocar o que funciona. O que tenho visto em operaÃ§Ãµes com perfil parecido com o da ' + emp + ' Ã© que a soluÃ§Ã£o atual resolve bem o que foi desenhada para resolver â€” mas deixa janelas abertas que sÃ³ aparecem quando vocÃª cruza os dados de outro Ã¢ngulo. Vale 20 minutos para olhar isso junto?';
  else
    objTxt = 'A conversa foi boa e o caminho estÃ¡ claro. Agora Ã© sobre execuÃ§Ã£o.';

  var fechamento;
  if (tom === 'Consultivo')
    fechamento = prox
      ? 'Conforme alinhamos: ' + prox + '. Qualquer dÃºvida no meio do caminho, pode me chamar diretamente.'
      : 'Qual seria o melhor prÃ³ximo passo â€” uma call rÃ¡pida, um material para anÃ¡lise ou uma visita tÃ©cnica?';
  else if (tom === 'UrgÃªncia suave')
    fechamento = prox
      ? prox + '. SÃ³ me avisa se precisar antecipar â€” consigo encaixar ainda essa semana.'
      : 'Tenho duas janelas disponÃ­veis ainda essa semana. Me diz o que funciona melhor para vocÃª.';
  else
    fechamento = prox
      ? prox + '. Estarei no aguardo.'
      : 'Me diz atÃ© quando vocÃª consegue avaliar isso â€” assim alinhamos o prÃ³ximo passo.';

  var assunto = tom === 'UrgÃªncia suave'
    ? 'PrÃ³ximos passos â€” ' + emp
    : 'Re: nossa conversa de hoje â€” ' + emp;

  var corpo = 'Assunto: ' + assunto + '\n\n'
    + abertura + '\n\n'
    + contexto + '\n\n'
    + objTxt + '\n\n'
    + fechamento + '\n\n'
    + 'Nelson Lima\n[Cargo] | [Empresa]\n[Telefone]';

  setOut('fu-box', 'fu-out', corpo);
  toast('E-mail gerado!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROSPECÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function gerarPR() {
  var emp   = document.getElementById('pr-empresa').value.trim() || 'sua empresa';
  var con   = document.getElementById('pr-contato').value.trim();
  var cargo = document.getElementById('pr-cargo').value;
  var gat   = document.getElementById('pr-gatilho').value;
  var tipo  = document.getElementById('pr-tipo').value;
  var ind   = document.getElementById('pr-ind').value.trim();
  var nome  = con ? con.split(' ')[0] : 'OlÃ¡';

  var fato, dor;
  if (gat === 'ExpansÃ£o de lojas') {
    fato = 'Acompanhei a expansÃ£o recente da ' + emp + ' â€” crescimento de operaÃ§Ã£o Ã© exatamente o momento em que os gargalos de gestÃ£o aparecem.';
    if (cargo.indexOf('TI') >= 0)
      dor = 'Cada nova loja Ã© uma integraÃ§Ã£o nova, um ponto de falha novo. Ã‰ muito difÃ­cil escalar tecnologia no mesmo ritmo que a operaÃ§Ã£o cresce.';
    else if (cargo.indexOf('OperaÃ§Ãµes') >= 0)
      dor = 'Com expansÃ£o acelerada, o controle de perdas e o padrÃ£o operacional entre lojas tendem a deteriorar. JÃ¡ vi isso acontecer em redes sÃ³lidas.';
    else
      dor = 'Crescimento sem visibilidade centralizada Ã© o caminho mais rÃ¡pido para perder margem sem saber onde.';
  } else if (gat === 'Abertura de mercado') {
    fato = 'Vi que a ' + emp + ' estÃ¡ abrindo novos mercados â€” momento crÃ­tico para garantir que a operaÃ§Ã£o nÃ£o perca o padrÃ£o que construiu.';
    dor  = 'Operar em mercado novo com os mesmos processos do mercado de origem raramente funciona. A ' + emp + ' vai precisar de visibilidade em tempo real para ajustar rÃ¡pido.';
  } else if (gat === 'Troca de sistema') {
    fato = 'Fiquei sabendo que a ' + emp + ' estÃ¡ avaliando novas soluÃ§Ãµes de tecnologia â€” esse processo costuma ser mais longo do que o planejado se nÃ£o tiver critÃ©rios claros desde o inÃ­cio.';
    dor  = 'Em 20 anos acompanhando trocas de sistema no varejo, o maior erro que vejo Ã© comprar tecnologia sem mapear primeiro onde a operaÃ§Ã£o realmente sangra. Posso ajudar nesse mapeamento.';
  } else {
    fato = 'Tenho acompanhado operaÃ§Ãµes com o perfil da ' + emp + ' hÃ¡ anos â€” e hÃ¡ um padrÃ£o de oportunidade que aparece quase sempre nesse segmento.';
    if (cargo.indexOf('TI') >= 0)
      dor = 'Sistemas legados, integraÃ§Ãµes frÃ¡geis e dados descentralizados: sÃ£o os trÃªs pontos que mais consomem o tempo de TI no varejo sem entregar valor visÃ­vel para o negÃ³cio.';
    else if (cargo.indexOf('OperaÃ§Ãµes') >= 0)
      dor = 'No varejo alimentar, as maiores perdas nÃ£o aparecem nos relatÃ³rios â€” estÃ£o nas quebras nÃ£o identificadas, nos processos manuais e no que o time de loja nÃ£o consegue reportar.';
    else
      dor = 'A diferenÃ§a entre as redes que crescem com margem e as que crescem com dÃ­vida estÃ¡, quase sempre, na qualidade da informaÃ§Ã£o que chega atÃ© quem decide.';
  }

  var msg;
  if (tipo === 'email') {
    msg = 'Assunto: ' + emp + ' â€” um ponto que vale 20 minutos\n\n'
      + nome + ',\n\n'
      + fato + '\n\n'
      + dor + '\n\n'
      + 'Tenho trabalhado com redes do porte da ' + emp + ' nos Ãºltimos anos e o que percebo Ã© que pequenas mudanÃ§as na forma de operar geram impacto desproporcional no resultado.\n\n'
      + 'NÃ£o estou pedindo uma reuniÃ£o de vendas. Estou propondo 20 minutos para trocar experiÃªncia sobre o que estÃ¡ funcionando no mercado. Se fizer sentido seguir, a gente avanÃ§a.\n\n'
      + 'Funciona essa semana?\n\n'
      + 'Nelson Lima\n[Cargo] | [Empresa]\n[Telefone]';
  } else if (tipo === 'linkedin') {
    msg = nome + ',\n\n'
      + fato + '\n\n'
      + dor + '\n\n'
      + 'Tenho ajudado gestores de ' + cargo.toLowerCase() + ' em redes como a ' + emp + ' a transformar esse tipo de problema em vantagem competitiva real.\n\n'
      + 'NÃ£o Ã© pitch â€” Ã© troca de experiÃªncia. 15 minutos essa semana?';
  } else if (tipo === 'whatsapp') {
    msg = nome + ', tudo bem?\n\n'
      + 'Sou o Nelson Lima, trabalho com gestÃ£o e tecnologia para varejo alimentar hÃ¡ mais de 20 anos.\n\n'
      + fato + '\n\n'
      + 'Tenho uma perspectiva que pode ser Ãºtil para quem estÃ¡ nesse momento. Posso te mandar um voice de 2 minutos?\n\n'
      + 'Se fizer sentido, a gente marca um papo.';
  } else {
    var ref = ind || 'um contato em comum';
    msg = nome + ',\n\n'
      + 'O ' + ref + ' me sugeriu falar com vocÃª â€” e depois de entender o contexto da ' + emp + ', entendi por quÃª.\n\n'
      + fato + '\n\n'
      + dor + '\n\n'
      + '20 minutos bem objetivos jÃ¡ sÃ£o suficientes para vocÃª avaliar se vale aprofundar.\n\n'
      + 'Quando funciona para vocÃª?\n\n'
      + 'Nelson Lima\n[Cargo] | [Empresa]\n[Telefone]';
  }

  setOut('pr-box', 'pr-out', msg);
  toast('Mensagem gerada!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ROI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mR(el) {
  var v = el.value.replace(/\D/g, '');
  if (!v) { el.value = ''; return; }
  v = (parseInt(v) / 100).toFixed(2);
  el.value = 'R$ ' + parseFloat(v).toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});
}
function pR(id) {
  var el = document.getElementById(id);
  if (!el) return 0;
  return parseFloat((el.value || '').replace(/[R$\s.]/g, '').replace(',', '.')) || 0;
}
function fBR(v) {
  return 'R$ ' + Math.abs(v).toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2});
}
function calcROI() {
  var proj  = document.getElementById("roi-proj").value.trim() || "Projeto";
  var capex = pR("roi-capex"), opex = pR("roi-opex");
  var pdvs  = parseFloat(document.getElementById("roi-pdvs").value) || 0;
  var fat   = pR("roi-fat");
  var ptot  = parseFloat(document.getElementById("roi-ptot").value) || 0;
  var pni   = parseFloat(document.getElementById("roi-pni").value) || 0;
  var meta  = parseFloat(document.getElementById("roi-meta").value) || 0;
  if (!pdvs || !fat || !ptot || !pni || !meta || (!capex && !opex)) return;

  var fatT  = fat * pdvs;
  var pT    = fatT * (ptot / 100);
  var pNI   = pT * (pni / 100);
  var eco   = pNI * (meta / 100);
  var pb    = capex > 0 ? Math.ceil(capex / eco) : null;
  var saldo = opex  > 0 ? eco - opex : null;

  var res = document.getElementById("roi-res");
  res.innerHTML = "";
  res.style.cssText = "display:flex;flex-direction:column;gap:13px";

  function makeCard(title, rowsData, accent) {
    var wrap = document.createElement("div");
    wrap.style.cssText = "background:var(--surface2);border:1px solid var(--border);border-radius:9px;overflow:hidden";
    var head = document.createElement("div");
    head.style.cssText = "background:var(--surface);border-bottom:1px solid var(--border);padding:7px 13px;font-size:11px;color:var(--muted)";
    head.textContent = title;
    wrap.appendChild(head);
    var tbl = document.createElement("table");
    tbl.style.cssText = "width:100%;border-collapse:collapse;font-size:13px";
    rowsData.forEach(function(r) {
      var tr = document.createElement("tr");
      if (r.bg) tr.style.background = r.bg;
      var td1 = document.createElement("td");
      td1.style.cssText = "padding:8px 12px;border-bottom:1px solid var(--border);font-weight:" + (r.bold ? "700" : "400") + ";color:" + (r.color || "var(--ink2)");
      td1.textContent = r.label;
      var td2 = document.createElement("td");
      td2.style.cssText = "padding:8px 12px;border-bottom:1px solid var(--border);text-align:right;font-weight:600;color:" + (r.color || "var(--ink)") + ";font-size:" + (r.big ? "16px" : "13px");
      td2.textContent = r.value;
      tr.appendChild(td1); tr.appendChild(td2); tbl.appendChild(tr);
    });
    wrap.appendChild(tbl);
    return wrap;
  }

  var top = document.createElement("div");
  top.style.cssText = "display:grid;grid-template-columns:1fr 1fr;gap:13px";

  var rows1 = [];
  if (capex > 0) rows1.push({label:"CAPEX", value:fBR(capex)});
  if (opex  > 0) rows1.push({label:"OPEX/mes", value:fBR(opex)});
  rows1.push({label:"Fat. total/mes", value:fBR(fatT)});
  top.appendChild(makeCard(proj, rows1));

  top.appendChild(makeCard(pdvs + " PDV" + (pdvs>1?"s":""), [
    {label:"Fat. por PDV", value:fBR(fat)},
    {label:"Fat. total",   value:fBR(fatT)}
  ]));
  res.appendChild(top);

  res.appendChild(makeCard("Analise de Perdas", [
    {label:"Perdas totais ("+ptot+"%)",          value:fBR(pT)},
    {label:"Perdas nao identificadas ("+pni+"%)", value:fBR(pNI)},
    {label:"Economia estimada ("+meta+"%)",       value:fBR(eco), color:"var(--sesami)", bold:true, bg:"rgba(92,229,219,0.06)"}
  ]));

  var resRows = [];
  if (pb !== null)    resRows.push({label:"Payback CAPEX",   value:pb+" meses",        color:"var(--sesami)", bold:true, big:true});
  if (saldo !== null) resRows.push({label:"Saldo OPEX",      value:fBR(saldo)+" ("+(saldo>=0?"positivo":"negativo")+")", color:saldo>=0?"var(--sesami)":"var(--hot)", bold:true, bg:saldo>=0?"rgba(92,229,219,0.06)":"rgba(255,71,87,0.06)"});
  res.appendChild(makeCard("Resultado", resRows));
}
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PIPELINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var deals = JSON.parse(localStorage.getItem('sesami-deals') || '[]');
var dmCol = 'prospeccao';
var dragId = null;

function fmt(v) { return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0}).format(v); }

function renderP() {
  var cols = ['prospeccao','qualificacao','proposta','negociacao','fechado'];
  for (var c = 0; c < cols.length; c++) {
    var col = cols[c];
    var el  = document.getElementById('col-' + col);
    if (!el) continue;
    var cd  = deals.filter(function(d){return d.col===col;});
    var cntEl = document.getElementById('cnt-' + col);
    if (cntEl) cntEl.textContent = cd.length;
    var html = '';
    for (var i = 0; i < cd.length; i++) {
      var d = cd[i];
      html += '<div class="dcard" draggable="true" id="dc-' + d.id + '" ondragstart="ds(event,'' + d.id + '')" ondragend="de(event)">'
        + '<div style="display:flex;justify-content:space-between;align-items:flex-start;gap:5px">'
        + '<div style="flex:1;min-width:0"><div class="dname">' + d.emp + '</div><div class="dco">' + d.cont + '</div></div>'
        + '<button class="bdel" onclick="delDeal('' + d.id + '')" draggable="false">x</button>'
        + '</div>'
        + (d.val ? '<div class="dval">' + fmt(d.val) + '</div>' : '')
        + (d.data ? '<div class="ddate">ğŸ“… ' + new Date(d.data + 'T12:00:00').toLocaleDateString('pt-BR') + '</div>' : '')
        + '</div>';
    }
    el.innerHTML = html;
  }
  var tot = deals.length;
  var vt  = deals.reduce(function(s,d){return s+(d.val||0);}, 0);
  var ptEl=document.getElementById('pt'); if(ptEl) ptEl.textContent=tot;
  var pvEl=document.getElementById('pv'); if(pvEl) pvEl.textContent=fmt(vt);
  var phEl=document.getElementById('ph'); if(phEl) phEl.textContent=deals.filter(function(d){return d.col==='negociacao';}).length;
  var pfEl=document.getElementById('pf'); if(pfEl) pfEl.textContent=fmt(deals.filter(function(d){return d.col==='fechado';}).reduce(function(s,d){return s+(d.val||0);},0));
}
function ds(e, id) {
  dragId = id;
  e.dataTransfer.effectAllowed = 'move';
  setTimeout(function(){var el=document.getElementById('dc-'+id);if(el)el.style.opacity='0.4';}, 0);
}
function de() {
  if (dragId) { var el=document.getElementById('dc-'+dragId); if(el)el.style.opacity='1'; }
}
function dov(e) { e.preventDefault(); e.currentTarget.classList.add('over'); }
function dlv(e) { e.currentTarget.classList.remove('over'); }
function dp(e, col) {
  e.preventDefault();
  e.currentTarget.classList.remove('over');
  if (!dragId) return;
  var d = deals.find(function(x){return x.id===dragId;});
  if (d) { d.col = col; saveP(); renderP(); }
  dragId = null;
}
function openDM(col) {
  dmCol = col;
  ['d-emp','d-cont','d-obs'].forEach(function(id){document.getElementById(id).value='';});
  ['d-val','d-data'].forEach(function(id){document.getElementById(id).value='';});
  document.getElementById('dm').classList.add('open');
}
function closeDM() { document.getElementById('dm').classList.remove('open'); }
function saveDeal() {
  var emp = document.getElementById('d-emp').value.trim();
  if (!emp) { toast('Informe a empresa'); return; }
  deals.push({
    id: Date.now().toString(),
    emp: emp,
    cont: document.getElementById('d-cont').value.trim(),
    val:  parseFloat(document.getElementById('d-val').value) || 0,
    data: document.getElementById('d-data').value,
    obs:  document.getElementById('d-obs').value.trim(),
    col:  dmCol
  });
  saveP(); closeDM(); renderP(); toast('Oportunidade adicionada!');
}
function delDeal(id) {
  if (!confirm('Excluir esta oportunidade?')) return;
  deals = deals.filter(function(d){return d.id!==id;});
  saveP(); renderP(); toast('ExcluÃ­da!');
}
function saveP() { localStorage.setItem('sesami-deals', JSON.stringify(deals)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RADAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
var TG_TOKEN = '8303969262:AAFKWK1ewgNnQMASnvJ8KkFR8OB3MY1RR1M';
var TG_CHAT  = '8719617102';
var TG_API   = 'https://api.telegram.org/bot' + TG_TOKEN;
var SBU = 'https://hvncjjuwzlgldxbfauxv.supabase.co';
var SBK = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2bmNqanV3emxnbGR4YmZhdXh2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MzA5NTEsImV4cCI6MjA4NzIwNjk1MX0.5FzYbLZnthTnBUakOVuH_zWoC26iDOtFRCq0bNT4VPc';
var TBL = 'contas';
var COLS = [['#5CE5DB','#0a2a28'],['#4d9fff','#0a1a2e'],['#ff6b35','#2e1a0a'],['#a855f7','#1e0a2e'],['#f59e0b','#2e1e0a'],['#ec4899','#2e0a1e'],['#10b981','#0a2e1e'],['#6366f1','#0a0e2e']];
var raccs = [], rrole = '', rfilt = 'all', rsigf = null, rsegf = 'all', rsort = 'priority', rsearch = '';

function sbH(x) {
  x = x || {};
  var h = {'apikey':SBK,'Authorization':'Bearer '+SBK,'Content-Type':'application/json','Prefer':'return=minimal'};
  for (var k in x) h[k] = x[k];
  return h;
}

async function tgSend(msg) {
  try {
    await fetch(TG_API + '/sendMessage', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({chat_id: TG_CHAT, text: msg, parse_mode: 'HTML'})
    });
  } catch(e) {}
}

async function tgAlert(acc, action) {
  var priLabel = acc.priority==='hot' ? 'QUENTE' : acc.priority==='warm' ? 'MORNO' : 'FRIO';
  var header = action==='add' ? 'Nova conta adicionada ao Radar' : action==='hot' ? 'Conta ficou QUENTE!' : 'Novo sinal registrado';
  var sigs = acc.signals && acc.signals.length
    ? acc.signals.slice(0,2).map(function(s){return '  - ' + s.text;}).join('\n')
    : '  - Sem sinais ainda.';
  var msg = header + '\n\n' + acc.name + ' | ' + (acc.segment||'-') + ' | ' + priLabel + '\n\nSinais:\n' + sigs;
  await tgSend(msg);
}

function initRadar() {
  var s = sessionStorage.getItem('sesami-role');
  if (!s) {
    document.getElementById('rscreen').classList.add('open');
  } else {
    rrole = s;
    rApply();
    if (!window._rl) {
      rLoad();
      setInterval(rLoad, 3600000);
      setInterval(tgPollSignals, 30000);
      window._rl = true;
    }
  }
}
function rEnter(role) {
  rrole = role;
  sessionStorage.setItem('sesami-role', role);
  document.getElementById('rscreen').classList.remove('open');
  rApply();
  if (!window._rl) { rLoad(); setInterval(rLoad,3600000); setInterval(tgPollSignals,30000); window._rl=true; }
}
function rSwitch() { sessionStorage.removeItem('sesami-role'); window._rl=false; document.getElementById('rscreen').classList.add('open'); }
function rApply() {
  var a = rrole==='admin';
  var b = document.getElementById('r-role-badge');
  b.textContent = a ? 'Admin' : 'Viewer';
  b.className = 'rrole' + (a ? '' : ' v');
  document.getElementById('radmin-btns').style.display = a ? 'flex' : 'none';
}

async function rLoad() {
  rSync('ld','carregando...');
  try {
    var r = await fetch(SBU+'/rest/v1/'+TBL+'?select=*&order=updated_at.desc', {headers:sbH()});
    if (!r.ok) throw new Error();
    var rows = await r.json();
    raccs = rows.map(function(x){return x.data;}).filter(Boolean);
    rRender();
    rSync('sy', raccs.length + ' contas');
  } catch(e) { rSync('er','erro ao sincronizar'); }
}

async function rSaveAcc(acc) {
  try {
    await fetch(SBU+'/rest/v1/'+TBL, {
      method:'POST',
      headers: sbH({'Prefer':'resolution=merge-duplicates,return=minimal'}),
      body: JSON.stringify({id:String(acc.id), data:acc, updated_at:new Date().toISOString()})
    });
  } catch(e) {}
}

async function tgPollSignals() {
  try {
    var r = await fetch(SBU+'/rest/v1/tg_signals?processed=eq.false&select=*&order=created_at.asc&limit=20', {headers:sbH()});
    if (!r.ok) return;
    var rows = await r.json();
    if (!rows.length) return;
    for (var i=0; i<rows.length; i++) {
      var row = rows[i];
      var d = row.data;
      if (!d || !d.empresa || !d.sinal) continue;
      var tyMap = {expansao:'expansion',expansion:'expansion',noticia:'news',news:'news',concorrente:'competitor',competitor:'competitor'};
      var sigType = tyMap[(d.tipo||'').toLowerCase()] || 'expansion';
      var acc = null;
      for (var j=0; j<raccs.length; j++) {
        if (raccs[j].name && raccs[j].name.toLowerCase()===d.empresa.toLowerCase()) { acc=raccs[j]; break; }
      }
      if (acc) {
        acc.signals.unshift({type:sigType, text:d.sinal, time:'via Telegram'});
        if (acc.priority==='hot') await tgAlert(acc,'hot');
        await rSaveAcc(acc);
      } else {
        var newAcc = {id:Date.now(), name:d.empresa, segment:d.segmento||'Outros', priority:d.prioridade||'cold', stores:null, color:COLS[raccs.length%COLS.length], signals:[{type:sigType,text:d.sinal,time:'via Telegram'}], createdAt:Date.now()};
        raccs.push(newAcc);
        await rSaveAcc(newAcc);
        await tgAlert(newAcc,'add');
      }
      await fetch(SBU+'/rest/v1/tg_signals?id=eq.'+row.id, {method:'PATCH', headers:sbH(), body:JSON.stringify({processed:true})});
    }
    rRender();
  } catch(e) { console.log('TG poll error',e); }
}

function rSync(cls,msg) { var el=document.getElementById('rsync'); el.className='rsync '+cls; el.textContent=msg; }

function rGetFilt() {
  return raccs.filter(function(a){
    if (rfilt!=='all' && a.priority!==rfilt) return false;
    if (rsegf!=='all' && a.segment!==rsegf) return false;
    if (rsearch && a.name.toLowerCase().indexOf(rsearch.toLowerCase())<0) return false;
    if (rsigf && !a.signals.some(function(s){return s.type===rsigf;})) return false;
    return true;
  });
}
function rGetSort(list) {
  var o = {hot:0,warm:1,cold:2};
  return list.slice().sort(function(a,b){
    if (rsort==='priority') return o[a.priority]-o[b.priority];
    if (rsort==='name') return a.name.localeCompare(b.name);
    if (rsort==='signals') return b.signals.length-a.signals.length;
    return 0;
  });
}
function rRender() {
  var grid=document.getElementById('rcards'), empty=document.getElementById('rempty');
  var list=rGetSort(rGetFilt());
  rStats(); rCounts();
  if (!list.length) { grid.innerHTML=''; empty.classList.add('on'); return; }
  empty.classList.remove('on');
  var isA = rrole==='admin';
  var si = {expansion:'ğŸ—ï¸',news:'ğŸ“°',competitor:'âš”ï¸'};
  var bl = {hot:'ğŸ”´ Quente',warm:'ğŸŸ¡ Morno',cold:'ğŸ”µ Frio'};
  var html = '';
  for (var i=0; i<list.length; i++) {
    var a = list[i];
    var cl = a.color || COLS[i%COLS.length];
    var init = a.name.split(' ').slice(0,2).map(function(w){return w[0];}).join('').toUpperCase();
    var sigs = a.signals.slice(0,2).map(function(s){
      return '<div class="sig ' + s.type + '">'
        + '<div class="sigicon">' + (si[s.type]||'ğŸ“Œ') + '</div>'
        + '<div class="sigtext">' + s.text + '</div>'
        + '<div class="sigtime">' + s.time + '</div>'
        + '</div>';
    }).join('');
    html += '<div class="acard ' + a.priority + '" style="animation-delay:' + (i*0.04) + 's">'
      + '<div class="atop">'
      + '<div style="display:flex;align-items:center;gap:9px">'
      + '<div class="aavatar" style="background:' + cl[1] + ';color:' + cl[0] + '">' + init + '</div>'
      + '<div><div class="aname">' + a.name + '</div><div class="aseg">' + (a.segment||'') + (a.stores?' Â· '+Number(a.stores).toLocaleString()+' lojas':'') + '</div></div>'
      + '</div>'
      + '<div class="abadge b' + a.priority[0] + '">' + bl[a.priority] + '</div>'
      + '</div>'
      + '<div class="asigs">' + sigs + '</div>'
      + '<div id="rp-' + a.id + '" class="aipanel"></div>'
      + '<div class="afoot">'
      + '<div class="acnt"><span>' + a.signals.length + '</span> sinal' + (a.signals.length!==1?'is':'') + '</div>'
      + '<div class="aacts">'
      + '<button class="raibtn" id="rai-' + a.id + '" onclick="rAI('' + a.id + '')">âœ¨ Resumo IA</button>'
      + (isA ? '<button class="rabtn" onclick="rSigModal('' + a.id + '')">+ Sinal</button>' : '')
      + '</div></div></div>';
  }
  grid.innerHTML = html;
}
function rStats() {
  document.getElementById('r-tot').textContent = raccs.length;
  document.getElementById('r-hot').textContent = raccs.filter(function(a){return a.priority==='hot';}).length;
  document.getElementById('r-sig').textContent = raccs.reduce(function(s,a){return s+a.signals.length;},0);
  document.getElementById('r-opp').textContent = raccs.filter(function(a){return a.priority!=='cold';}).length;
}
function rCounts() {
  document.getElementById('r-call').textContent  = raccs.length;
  document.getElementById('r-chot').textContent  = raccs.filter(function(a){return a.priority==='hot';}).length;
  document.getElementById('r-cwarm').textContent = raccs.filter(function(a){return a.priority==='warm';}).length;
  document.getElementById('r-ccold').textContent = raccs.filter(function(a){return a.priority==='cold';}).length;
}
function rSF(f,btn) {
  rfilt=f; rsigf=null; rsegf='all';
  document.querySelectorAll('.rfbtn').forEach(function(b){b.classList.remove('on');});
  btn.classList.add('on');
  var l={all:'Todas as Contas',hot:'Contas Quentes',warm:'Contas Mornas',cold:'Contas Frias'};
  document.getElementById('r-sec-title').textContent = l[f]||'Contas';
  rRender(); closeMobSidebar();
}
function rSSig(f,btn) {
  rsigf = rsigf===f ? null : f;
  document.querySelectorAll('.rfbtn').forEach(function(b){b.classList.remove('on');});
  if (rsigf) btn.classList.add('on');
  rRender(); closeMobSidebar();
}
function rSSeg(f,btn) {
  rsegf=f;
  document.querySelectorAll('.rfbtn').forEach(function(b){b.classList.remove('on');});
  btn.classList.add('on');
  rRender(); closeMobSidebar();
}
function rFilt() { rsearch=document.getElementById('rsearch').value; rRender(); }
function rSortC(v) { rsort=v; rRender(); }

var rSigFor = null;
function openRM() {
  if (rrole!=='admin') return;
  rSigFor=null;
  document.getElementById('rm-title').textContent='Nova Conta';
  ['rf-name','rf-stores','rf-sigtxt'].forEach(function(id){document.getElementById(id).value='';});
  document.getElementById('rm-modal').classList.add('open');
}
function rSigModal(id) {
  if (rrole!=='admin') return;
  rSigFor=id;
  var a=raccs.find(function(x){return x.id==id;});
  document.getElementById('rm-title').textContent = '+ Sinal: ' + a.name;
  document.getElementById('rf-name').value  = a.name;
  document.getElementById('rf-seg').value   = a.segment||'';
  document.getElementById('rf-pri').value   = a.priority;
  document.getElementById('rf-stores').value= a.stores||'';
  document.getElementById('rf-sigtxt').value= '';
  document.getElementById('rm-modal').classList.add('open');
}
function closeRM() { document.getElementById('rm-modal').classList.remove('open'); rSigFor=null; }

async function rAddAcc() {
  if (rrole!=='admin') return;
  var name=document.getElementById('rf-name').value.trim();
  if (!name) { toast('Informe o nome'); return; }
  var seg=document.getElementById('rf-seg').value;
  var pri=document.getElementById('rf-pri').value;
  var stores=document.getElementById('rf-stores').value;
  var sigt=document.getElementById('rf-sigtxt').value.trim();
  var sigty=document.getElementById('rf-sigtyp').value;
  if (rSigFor!==null) {
    var acc=raccs.find(function(x){return x.id==rSigFor;});
    var oldPri=acc.priority;
    acc.priority=pri;
    if (sigt) acc.signals.unshift({type:sigty,text:sigt,time:'agora'});
    await rSaveAcc(acc);
    await tgAlert(acc,'signal');
    if (oldPri!=='hot' && pri==='hot') await tgAlert(acc,'hot');
    toast('Sinal adicionado!');
  } else {
    var newAcc={id:Date.now(),name:name,segment:seg,priority:pri,stores:stores||null,color:COLS[raccs.length%COLS.length],signals:sigt?[{type:sigty,text:sigt,time:'agora'}]:[],createdAt:Date.now()};
    raccs.push(newAcc);
    await rSaveAcc(newAcc);
    await tgAlert(newAcc,'add');
    toast('Conta adicionada!');
  }
  closeRM(); rRender();
}

async function rAI(id) {
  var acc=raccs.find(function(a){return a.id==id;});
  var panel=document.getElementById('rp-'+id);
  var btn=document.getElementById('rai-'+id);
  if (panel.classList.contains('on')) { panel.classList.remove('on'); return; }
  var opM={
    'Supermercados':'AutomaÃ§Ã£o de checkout e gestÃ£o de estoque sÃ£o altamente relevantes.',
    'Farmacias':'Sistemas de gestÃ£o, omnichannel e fidelizaÃ§Ã£o tÃªm alta demanda.',
    'Moda':'Plataformas de e-commerce e experiÃªncia phygital sÃ£o diferenciais.',
    'Eletronicos':'IntegraÃ§Ã£o de canais e pÃ³s-venda digital sÃ£o eficazes.',
    'Home Center':'GestÃ£o de SKUs complexos e marketplace sÃ£o prioridades.'
  };
  var aM={
    hot:'Conta QUENTE â€” agende reuniÃ£o esta semana.',
    warm:'Conta MORNA â€” envie case de sucesso e proponha diagnÃ³stico.',
    cold:'Conta FRIA â€” mantenha nurturing com conteÃºdo relevante.'
  };
  var si={expansion:'ğŸ—ï¸',news:'ğŸ“°',competitor:'âš”ï¸'};
  var momento = acc.signals.length
    ? acc.signals.slice(0,3).map(function(s){return '  ' + (si[s.type]||'ğŸ“Œ') + ' ' + s.text;}).join('\n')
    : '  Nenhum sinal registrado ainda.';
  var txt = 'MOMENTO (' + (acc.priority==='hot'?'QUENTE':acc.priority==='warm'?'MORNO':'FRIO') + ')\n' + momento
    + '\n\nOPORTUNIDADE\n' + (opM[acc.segment]||'SoluÃ§Ãµes de gestÃ£o integrada podem gerar valor imediato.')
    + '\n\nAÃ‡ÃƒO\n' + aM[acc.priority];
  panel.innerHTML = '<div class="aipanel-h"><div class="ailbl">AnÃ¡lise</div></div><div class="aitext" id="rait-' + id + '"></div>';
  panel.classList.add('on');
  var el=document.getElementById('rait-'+id);
  var idx=0;
  var iv=setInterval(function(){
    if (idx < txt.length) { el.textContent += txt[idx]; idx++; }
    else clearInterval(iv);
  }, 8);
}

async function rAutofill() { toast('Preencha os campos manualmente.'); }

function rExcel() {
  var pl={hot:'Quente',warm:'Morno',cold:'Frio'};
  var rows=[['Empresa','Segmento','Prioridade','Lojas','Sinais','Detalhes']];
  raccs.forEach(function(a){rows.push([a.name,a.segment||'-',pl[a.priority],a.stores||'-',a.signals.length,a.signals.map(function(s){return s.text;}).join(' | ')]);});
  var wb=XLSX.utils.book_new(), ws=XLSX.utils.aoa_to_sheet(rows);
  ws['!cols']=[{wch:25},{wch:15},{wch:10},{wch:8},{wch:8},{wch:60}];
  XLSX.utils.book_append_sheet(wb,ws,'Radar');
  XLSX.writeFile(wb,'radar-'+new Date().toLocaleDateString('pt-BR').replace(/\//g,'-')+'.xlsx');
  toast('Excel exportado!');
}

var riData=[];
function openRI() { if(rrole!=='admin')return; rResetI(); document.getElementById('ri-modal').classList.add('open'); }
function closeRI() { document.getElementById('ri-modal').classList.remove('open'); }
function rDov(e) { e.preventDefault(); document.getElementById('rdrop').classList.add('over'); }
function rDlv() { document.getElementById('rdrop').classList.remove('over'); }
function rDdrop(e) { e.preventDefault(); document.getElementById('rdrop').classList.remove('over'); var f=e.dataTransfer.files[0]; if(f)rPF(f); }
function rHF(e) { var f=e.target.files[0]; if(f)rPF(f); }
function rPF(file) {
  var rdr=new FileReader(), csv=file.name.endsWith('.csv');
  rdr.onload=function(e){
    var rows=[];
    if(csv) rows=e.target.result.split('\n').map(function(r){return r.split(/[,;]/).map(function(c){return c.trim().replace(/^"|"$/g,'');});});
    else { var wb=XLSX.read(e.target.result,{type:'binary'}); rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{header:1,defval:''}); }
    rParseI(rows);
  };
  if(csv) rdr.readAsText(file,'UTF-8'); else rdr.readAsBinaryString(file);
}
function rParseI(rows) {
  if(rows.length<2){toast('Arquivo vazio');return;}
  var h=rows[0].map(function(x){return String(x).toLowerCase().trim();});
  var ci={n:h.findIndex(function(x){return x.includes('nome')||x.includes('empresa');}),s:h.findIndex(function(x){return x.includes('seg');}),p:h.findIndex(function(x){return x.includes('prior');}),l:h.findIndex(function(x){return x.includes('loja');}),st:h.findIndex(function(x){return x.includes('sinal')||x.includes('obs');}),ty:h.findIndex(function(x){return x.includes('tipo');})};
  if(ci.n===-1){toast('Coluna Nome nao encontrada');return;}
  var pm={quente:'hot',hot:'hot',morno:'warm',warm:'warm',frio:'cold',cold:'cold','':'cold'};
  var tm={expansao:'expansion',expansion:'expansion',noticia:'news',news:'news',concorrente:'competitor',competitor:'competitor','':'expansion'};
  riData=rows.slice(1).filter(function(r){return r[ci.n]&&r[ci.n].toString().trim();}).map(function(r){
    function gv(i){return i>=0?String(r[i]||'').trim():'';}
    return{name:gv(ci.n),segment:gv(ci.s)||'Outros',priority:pm[gv(ci.p).toLowerCase()]||'cold',stores:gv(ci.l)||null,sigText:gv(ci.st),sigType:tm[gv(ci.ty).toLowerCase()]||'expansion'};
  });
  if(!riData.length){toast('Nenhuma conta valida');return;}
  var ex=raccs.map(function(a){return a.name.toLowerCase();});
  var nw=riData.filter(function(r){return !ex.includes(r.name.toLowerCase());});
  var pl2={hot:'Quente',warm:'Morno',cold:'Frio'};
  document.getElementById('ri-s1').style.display='none';
  document.getElementById('ri-s2').style.display='block';
  document.getElementById('risum').innerHTML='<div class="ristat"><div class="ristatv">'+riData.length+'</div><div class="ristatl">No arquivo</div></div><div class="ristat"><div class="ristatv" style="color:var(--r-accent)">'+nw.length+'</div><div class="ristatl">Novas</div></div><div class="ristat"><div class="ristatv" style="color:var(--warm)">'+(riData.length-nw.length)+'</div><div class="ristatl">Duplicadas</div></div>';
  document.getElementById('rprev').innerHTML='<thead><tr><th>Empresa</th><th>Segmento</th><th>Prioridade</th></tr></thead><tbody>'+riData.slice(0,8).map(function(r){return '<tr><td>'+r.name+'</td><td>'+r.segment+'</td><td>'+pl2[r.priority]+'</td></tr>';}).join('')+(riData.length>8?'<tr><td colspan="3" style="text-align:center;color:var(--r-muted)">... e mais '+(riData.length-8)+'</td></tr>':'')+'</tbody>';
}
async function rConfirmI() {
  var ex=raccs.map(function(a){return a.name.toLowerCase();}); var added=0; var na=[];
  riData.forEach(function(r){
    if(ex.includes(r.name.toLowerCase()))return;
    var acc={id:Date.now()+Math.random(),name:r.name,segment:r.segment,priority:r.priority,stores:r.stores||null,color:COLS[raccs.length%COLS.length],signals:r.sigText?[{type:r.sigType,text:r.sigText,time:'importado'}]:[],createdAt:Date.now()};
    raccs.push(acc);na.push(acc);added++;
  });
  closeRI(); rRender(); toast(added + ' conta(s) importada(s)!');
  await Promise.all(na.map(function(a){return rSaveAcc(a);}));
}
function rResetI() { riData=[]; document.getElementById('ri-s1').style.display='block'; document.getElementById('ri-s2').style.display='none'; document.getElementById('rfile').value=''; }
function rDlTpl() {
  var ws=XLSX.utils.aoa_to_sheet([['Nome','Segmento','Prioridade','Lojas','Sinal','Tipo Sinal'],['Grupo Exemplo','Supermercados','quente','120','Inaugurou 5 lojas em SP','expansao']]);
  ws['!cols']=[{wch:25},{wch:15},{wch:12},{wch:8},{wch:40},{wch:15}];
  var wb=XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb,ws,'Contas');
  XLSX.writeFile(wb,'modelo-radar.xlsx'); toast('Modelo baixado!');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setOut(boxId, outId, text) {
  document.getElementById(boxId).classList.add('got');
  var el = document.getElementById(outId);
  el.classList.remove('outph');
  el.textContent = text;
}
function cp(elId, btnId) {
  var t = document.getElementById(elId).textContent;
  if (!t || t.indexOf('Preencha') >= 0 || t.indexOf('Escolha') >= 0) { toast('Gere o conteudo primeiro'); return; }
  navigator.clipboard.writeText(t).then(function(){
    var b = document.getElementById(btnId);
    b.textContent = 'Copiado!'; b.classList.add('ok');
    setTimeout(function(){ b.textContent='Copiar'; b.classList.remove('ok'); }, 2000);
    toast('Copiado!');
  });
}
function toast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('on');
  setTimeout(function(){ t.classList.remove('on'); }, 2500);
}
function closeMobSidebar() {
  var s = document.querySelector('#page-radar .rsidebar');
  if (s && s.classList.contains('mob-open')) {
    s.classList.remove('mob-open');
    var btn = document.getElementById('r-mob-filters');
    if (btn) btn.textContent = 'Filtros';
  }
}
function toggleRSidebar() {
  var s = document.querySelector('#page-radar .rsidebar');
  if (!s) return;
  var isOpen = s.classList.contains('mob-open');
  s.classList.toggle('mob-open');
  var btn = document.getElementById('r-mob-filters');
  if (btn) btn.textContent = isOpen ? 'Filtros' : 'Fechar filtros';
}
function checkMobile() {
  var btn = document.getElementById('r-mob-filters');
  if (btn && window.innerWidth <= 768) btn.style.display = 'inline-flex';
}
window.addEventListener('resize', checkMobile);
window.addEventListener('load', checkMobile);



</script>
</body>
</html>